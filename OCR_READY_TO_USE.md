# ‚úÖ OCR v2.0 –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

## üéØ –ò—Ç–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:

‚úÖ **PaddleOCR** - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–≤–∏–∂–æ–∫ OCR v2.0  
‚úÖ **LayoutLMv3** - AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π  
‚úÖ **ValidatorService** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è  
‚úÖ **MinIO** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  
‚úÖ **Fallback** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –Ω–∞ Tesseract  
‚úÖ **Frontend** - PaddleOCR –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤  
‚úÖ **API** - `/providers` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  

---

## üìç –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ https://ibbase.ru/upload

### –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ OCR:

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ:

```
‚îå‚îÄ –ê–≤—Ç–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç v2.0
‚îÇ
‚îú‚îÄ ü§ñ OCR v2.0 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚îÇ  ‚îî‚îÄ PaddleOCR (AI + Cyrillic) ‚úÖ
‚îÇ
‚îî‚îÄ üî§ OCR v1.0 (–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)
   ‚îú‚îÄ Tesseract
   ‚îú‚îÄ Parsio (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
   ‚îî‚îÄ Google Vision (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
```

---

## üîÑ –ö–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å?

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (auto):
```
PaddleOCR (OCR v2.0)
‚Üì
‚Ä¢ –Ø–∑—ã–∫: cyrillic (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
‚Ä¢ –î–µ—Ç–µ–∫—Ü–∏—è: —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è (det_db_thresh=0.3)
‚Ä¢ AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: LayoutLMv3
‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è: ValidatorService
‚Ä¢ –ë–ª–æ–∫–æ–≤: 8-15 –Ω–∞ –≤–∏–∑–∏—Ç–∫—É
‚Ä¢ –¢–æ—á–Ω–æ—Å—Ç—å: 85-95%
‚Ä¢ Fallback: Tesseract (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
```

### –ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å —è–≤–Ω–æ:
- **PaddleOCR** ‚Üí OCR v2.0 (AI + Cyrillic)
- **Tesseract** ‚Üí OCR v1.0 (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)
- **Auto** ‚Üí v2.0 (PaddleOCR)

---

## üìä –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

```
–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–∑–∏—Ç–∫–∏
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ QR-–∫–æ–¥–∞
  ‚îú‚îÄ –ï—Å—Ç—å? ‚Üí –î–∞–Ω–Ω—ã–µ –∏–∑ QR
  ‚îî‚îÄ –ù–µ—Ç? ‚Üí OCR
      ‚Üì
  –ü—Ä–æ–≤–µ—Ä–∫–∞ ocr_version (v2.0 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      ‚Üì
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ   OCR v2.0 (primary)    ‚îÇ
  ‚îÇ   ‚Ä¢ PaddleOCR           ‚îÇ
  ‚îÇ   ‚Ä¢ LayoutLMv3          ‚îÇ
  ‚îÇ   ‚Ä¢ Validator           ‚îÇ
  ‚îÇ   ‚Ä¢ MinIO               ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ –û—à–∏–±–∫–∞?
       ‚Üì
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ   OCR v1.0 (fallback)   ‚îÇ
  ‚îÇ   ‚Ä¢ Tesseract           ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚Üì
  –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –±–ª–æ–∫–∞–º–∏
       ‚Üì
  –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PaddleOCR

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```python
# backend/app/integrations/ocr/providers_v2/paddle_provider.py

PaddleOCR(
    use_angle_cls=True,       # –£–≥–ª–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    lang='cyrillic',          # ‚úÖ –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ (–±—ã–ª–æ 'russian')
    use_gpu=False,            # CPU (GPU –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    show_log=False,           # –ú–∏–Ω–∏–º—É–º –ª–æ–≥–æ–≤
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ—Ç–µ–∫—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞:
    det_db_thresh=0.3,        # –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è
    det_db_box_thresh=0.5,    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ–∫—Å–æ–≤
    det_db_unclip_ratio=1.6,  # –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤
)
```

### –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:

```
‚úÖ Multilingual_PP-OCRv3_det_infer (~40MB) - –î–µ—Ç–µ–∫—Ü–∏—è
‚úÖ cyrillic_PP-OCRv3_rec_infer (~10MB) - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
‚úÖ ch_ppocr_mobile_v2.0_cls (~2MB) - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —É–≥–ª–æ–≤
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API

```bash
# –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
curl https://ibbase.ru/api/ocr/providers | jq

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
{
  "available": ["PaddleOCR"],
  "details": [{
    "name": "PaddleOCR",
    "available": true,
    "supports_bbox": true
  }]
}
```

### 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫—É

```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://ibbase.ru/upload
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
   ‚úÖ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å "PaddleOCR (AI + Cyrillic)"
3. –í—ã–±–µ—Ä–∏—Ç–µ "–ê–≤—Ç–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)" –∏–ª–∏ "PaddleOCR"
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä—É—Å—Å–∫—É—é –≤–∏–∑–∏—Ç–∫—É
5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (3-5 —Å–µ–∫)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç
curl -s "https://ibbase.ru/api/contacts?limit=1" \
  -H "Authorization: Bearer $TOKEN" | jq '.[0]'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏
CONTACT_ID=<–Ω–æ–≤—ã–π_id>
curl -s "https://ibbase.ru/api/ocr-blocks/$CONTACT_ID" | jq '{
  blocks: .lines | length,
  width: .image_width,
  height: .image_height
}'

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
{
  "blocks": 11,  # > 1 –±–ª–æ–∫–∞!
  "width": 1024,
  "height": 768
}
```

### 4. –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫–æ–≤

```
https://ibbase.ru/contacts/<CONTACT_ID>/ocr-editor

‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 8-15 –±–ª–æ–∫–æ–≤ (–Ω–µ 1)
‚úÖ –ë–ª–æ–∫–∏ –ø–µ—Ä–µ–¥–≤–∏–≥–∞—é—Ç—Å—è
‚úÖ –¢–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å v1.0

| –ü–∞—Ä–∞–º–µ—Ç—Ä | v1.0 (Tesseract) | v2.0 (PaddleOCR) |
|----------|------------------|------------------|
| **–Ø–∑—ã–∫** | rus+eng | cyrillic |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | 1-2 —Å–µ–∫ | 3-5 —Å–µ–∫ |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | 60-75% | 85-95% |
| **–ë–ª–æ–∫–æ–≤** | 1-3 | 8-15 |
| **AI** | ‚ùå | ‚úÖ LayoutLMv3 |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | ‚ùå | ‚úÖ Auto |
| **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã** | ‚ö†Ô∏è | ‚úÖ –¢–æ—á–Ω—ã–µ |
| **Fallback** | ‚Äî | ‚úÖ –Ω–∞ v1.0 |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–ê–≤—Ç–æ"** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç v2.0
2. **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –º–∏–Ω–∏–º—É–º 800x600px
3. **–•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ** - –±–µ–∑ —Ç–µ–Ω–µ–π –∏ –±–ª–∏–∫–æ–≤
4. **–ü—Ä—è–º–∞—è —Å—ä–µ–º–∫–∞** - –º–∏–Ω–∏–º—É–º –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã
5. **–†—É—Å—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π** - cyrillic –º–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞

### –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ—Ç–æ—á–Ω—ã–π:

1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
3. –ò–ª–∏ –≤—ã–∑–æ–≤–∏—Ç–µ `/rerun-ocr` endpoint –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

---

## üîÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ OCR:

```
https://ibbase.ru/admin?tab=settings
‚Üí "–í–µ—Ä—Å–∏—è OCR" ‚Üí v1.0 / v2.0
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ OCR –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞:

```bash
curl -X POST "https://ibbase.ru/api/contacts/<ID>/rerun-ocr" \
  -H "Authorization: Bearer $ADMIN_TOKEN"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:

```
https://ibbase.ru/settings
‚Üí "–ü—Ä–æ–≤–∞–π–¥–µ—Ä OCR –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
```

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **OCR_RECOGNITION_SCHEME.md** - –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- **OCR_SETUP_COMPLETE.md** - –ò—Ç–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **OCR_RERUN_ENDPOINT.md** - API –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ OCR
- **OCR_VERSION_TOGGLE.md** - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- **OCR_BLOCKS_FIX.md** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] PaddleOCR –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (cyrillic)
- [x] OCR v2.0 —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [x] LayoutLMv3 –∑–∞–≥—Ä—É–∂–µ–Ω
- [x] ValidatorService –∞–∫—Ç–∏–≤–µ–Ω
- [x] MinIO –¥–æ—Å—Ç—É–ø–µ–Ω
- [x] Fallback –Ω–∞ Tesseract —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç PaddleOCR
- [x] API `/providers` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ë–ª–æ–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- [x] –†–µ–¥–∞–∫—Ç–æ—Ä –±–ª–æ–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

---

## üöÄ –ù–∞—á–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://ibbase.ru/upload
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä: **–ê–≤—Ç–æ** –∏–ª–∏ **PaddleOCR**
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä—É—Å—Å–∫—É—é –≤–∏–∑–∏—Ç–∫—É
4. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å 8-15 –±–ª–æ–∫–∞–º–∏!

---

**–í–µ—Ä—Å–∏—è:** v6.1.3  
**–ö–æ–º–º–∏—Ç:** 11ea12b  
**–î–∞—Ç–∞:** 27 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY

