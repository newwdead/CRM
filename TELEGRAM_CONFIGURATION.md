# üì± –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –ë–æ—Ç–∞

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ù–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ê–∫—Ç–∏–≤–µ–Ω

### ü§ñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–æ—Ç–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Bot Name** | CRM_bot |
| **Username** | @NewCRMv1Bot |
| **Bot ID** | 8424260030 |
| **Bot Token** | `8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s` |
| **Webhook URL** | `https://ibbase.ru/telegram/webhook` |
| **Server IP** | 95.163.183.25 |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω |

### üîó –ë—ã—Å—Ç—Ä—ã–π –î–æ—Å—Ç—É–ø

**–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞:**
```
https://t.me/NewCRMv1Bot
```

### üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ë–æ—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ –≤–∏–∑–∏—Ç–æ–∫
2. ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å –ø–æ–º–æ—â—å—é OCR
3. ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   - –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—é
   - –î–æ–ª–∂–Ω–æ—Å—Ç—å
   - –ö–æ–º–ø–∞–Ω–∏—é
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - Email
   - –ê–¥—Ä–µ—Å
4. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –≤ CRM
5. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª —Ñ–æ—Ç–æ

### üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

#### 1. –ó–∞–ø—É—Å–∫ –ë–æ—Ç–∞
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ: @NewCRMv1Bot
3. –ù–∞–∂–º–∏—Ç–µ "Start" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start
4. –ë–æ—Ç –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—Å
```

#### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –í–∏–∑–∏—Ç–∫–∏
```
1. –°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –≤–∏–∑–∏—Ç–∫–∏ (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –±–æ—Ç—É
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
4. –ö–æ–Ω—Ç–∞–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω!
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–µ–∑—É–ª—å—Ç–∞—Ç–∞
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://ibbase.ru
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
```

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### Webhook Configuration
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getWebhookInfo"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
curl -X POST "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/setWebhook" \
  -d "url=https://ibbase.ru/telegram/webhook"

# –£–¥–∞–ª–∏—Ç—å webhook (–¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ polling)
curl -X POST "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/deleteWebhook"
```

#### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
SELECT key, value FROM app_settings WHERE key LIKE '%TELEGRAM%';

-- –û–±–Ω–æ–≤–∏—Ç—å webhook URL
UPDATE app_settings 
SET value = 'https://ibbase.ru/telegram/webhook' 
WHERE key = 'TELEGRAM_WEBHOOK_URL';

-- –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
UPDATE app_settings 
SET value = 'true' 
WHERE key = 'TELEGRAM_ENABLED';
```

#### Nginx Configuration
Endpoint —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `frontend/nginx.conf`:
```nginx
location = /telegram/webhook {
  proxy_pass http://backend:8000/telegram/webhook;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
}
```

### üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –û—Ç–ª–∞–¥–∫–∞

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –õ–æ–≥–æ–≤
```bash
# –í—Å–µ Telegram –ª–æ–≥–∏
docker compose logs backend -f | grep telegram

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
docker compose logs backend --tail 50 | grep telegram

# –û—à–∏–±–∫–∏
docker compose logs backend --tail 100 | grep -i "error.*telegram"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–æ—Ç–∞
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getMe"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getWebhookInfo"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoint
curl -I https://ibbase.ru/telegram/webhook
# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: HTTP/2 405 (Method Not Allowed) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ Telegram Web/App)
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ https://t.me/NewCRMv1Bot
# 2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start
# 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Ñ–æ—Ç–æ
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
docker compose logs backend -f | grep "telegram\|photo"
```

### üìä –ú–µ—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
- –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É–¥–∞—á–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

–ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤:
- **Prometheus**: http://95.163.183.25:9090
- **Grafana**: http://95.163.183.25:3001

### ‚ö†Ô∏è Troubleshooting

#### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getMe"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getWebhookInfo"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
docker compose logs backend --tail 100 | grep telegram

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
docker compose restart backend
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ç–æ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OCR –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
docker exec bizcard-db psql -U postgres -d bizcard_crm \
  -c "SELECT key, value FROM app_settings WHERE key LIKE '%OCR%';"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Tesseract —Ä–∞–±–æ—Ç–∞–µ—Ç
docker exec bizcard-backend tesseract --version

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ OCR
docker compose logs backend -f | grep -i "ocr\|tesseract"
```

#### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
curl -v https://ibbase.ru/telegram/webhook 2>&1 | grep "SSL\|certificate"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
curl -X POST https://ibbase.ru/telegram/webhook \
  -H "Content-Type: application/json" \
  -d '{"test": true}'

# 3. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook
curl -X POST "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/setWebhook" \
  -d "url=https://ibbase.ru/telegram/webhook" \
  -d "drop_pending_updates=true"
```

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
1. ‚ö†Ô∏è –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ Bot Token –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
2. ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ .env —Ñ–∞–π–ª–µ
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è webhook (—É –≤–∞—Å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
4. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ webhook –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
5. ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ endpoint —Ç–æ–ª—å–∫–æ –¥–ª—è Telegram IP

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `drop_pending_updates=true` –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ webhook
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `getWebhookInfo` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ `pending_update_count` - –µ—Å–ª–∏ —Ä–∞—Å—Ç–µ—Ç, –∑–Ω–∞—á–∏—Ç –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### üìù –ò—Å—Ç–æ—Ä–∏—è –ò–∑–º–µ–Ω–µ–Ω–∏–π

**2025-10-20**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω webhook URL: `www.ibbase.ru` ‚Üí `ibbase.ru`
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω webhook —á–µ—Ä–µ–∑ Telegram API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å endpoint
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ:**
- Bot Token –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- Webhook URL –Ω–∞ production –¥–æ–º–µ–Ω
- HTTPS endpoint –≤ Nginx
- OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:**
- Telegram Bot API: https://core.telegram.org/bots/api
- Webhook Guide: https://core.telegram.org/bots/webhooks
- Admin Panel: https://ibbase.ru/admin
- System Settings: https://ibbase.ru/admin ‚Üí ‚öôÔ∏è System Settings ‚Üí ‚úàÔ∏è Telegram

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:**
```bash
# –°—Ç–∞—Ç—É—Å
docker compose ps | grep backend

# –õ–æ–≥–∏
docker compose logs backend -f | grep telegram

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker compose restart backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞
curl "https://api.telegram.org/bot8424260030:AAEjZnx2zFQ4KvtP7SjnaHVxlL_1Qw9Pm5s/getWebhookInfo"
```

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-10-20  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-20  
**–í–µ—Ä—Å–∏—è:** v2.5.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

