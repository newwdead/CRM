# üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è BizCard CRM

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

Telegram –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **polling** (–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É).

---

## ü§ñ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ **—Ñ–æ—Ç–æ –≤–∏–∑–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏** –±–æ—Ç—É –≤ Telegram
2. –°–∫—Ä–∏–ø—Ç `telegram_polling.py` –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. –§–æ—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Tesseract OCR** (–∏–ª–∏ Parsio)
4. –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –≤ CRM
5. –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `uploads/`

---

## üìä –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **Bot Token** | `8424260030:AAE...Pm5s` |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –í–∫–ª—é—á–µ–Ω (enabled: true) |
| **–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —á–∞—Ç—ã** | –í—Å–µ (–ø—É—Å—Ç–æ = –ª—é–±–æ–π —á–∞—Ç) |
| **OCR –ø—Ä–æ–≤–∞–π–¥–µ—Ä** | Tesseract (–ª–æ–∫–∞–ª—å–Ω—ã–π) |
| **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã** | Polling (–Ω–µ webhook) |

---

## üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
sudo systemctl status telegram-polling
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```bash
sudo systemctl stop telegram-polling
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å
```bash
sudo systemctl start telegram-polling
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
sudo systemctl restart telegram-polling
```

### –õ–æ–≥–∏
```bash
sudo journalctl -u telegram-polling -f
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 1. –ò–∑–º–µ–Ω–∏—Ç—å Telegram —Ç–æ–∫–µ–Ω

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞:
```bash
sudo nano /etc/systemd/system/telegram-polling.service
```

–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É `Environment="TELEGRAM_TOKEN=..."` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
sudo systemctl daemon-reload
sudo systemctl restart telegram-polling
```

### 2. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —á–∞—Ç—ã

–ß–µ—Ä–µ–∑ Web UI –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Telegram –∏–ª–∏ —á–µ—Ä–µ–∑ API:
```bash
curl -X PUT http://localhost:8000/settings/telegram \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "token": "–≤–∞—à_—Ç–æ–∫–µ–Ω",
    "allowed_chats": "123456789,987654321",
    "provider": "tesseract"
  }'
```

### 3. –°–º–µ–Ω–∏—Ç—å OCR –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–∞ Parsio

```bash
curl -X PUT http://localhost:8000/settings/telegram \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "token": "–≤–∞—à_—Ç–æ–∫–µ–Ω",
    "allowed_chats": "",
    "provider": "parsio"
  }'
```

---

## üìù –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
```bash
sudo systemctl stop telegram-polling
cd /home/ubuntu/fastapi-bizcard-crm-ready
python3 telegram_polling.py
```

–ù–∞–∂–º–∏—Ç–µ `Ctrl+C` –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

---

## üîÑ Webhook vs Polling

### –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: **Polling** ‚úÖ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ (–Ω–µ –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π IP)
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- ‚úÖ –ü—Ä–æ—â–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (1-2 —Å–µ–∫—É–Ω–¥—ã)
- ‚ö†Ô∏è –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: **Webhook**

–î–ª—è production —Å –ø—É–±–ª–∏—á–Ω—ã–º IP –∏ –¥–æ–º–µ–Ω–æ–º –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
TELEGRAM_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"
curl -F "url=https://–≤–∞—à-–¥–æ–º–µ–Ω.com:8443/telegram/webhook" \
     -F "certificate=@/etc/nginx/certs/selfsigned.crt" \
     "https://api.telegram.org/bot${TELEGRAM_TOKEN}/setWebhook"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å polling
sudo systemctl stop telegram-polling
sudo systemctl disable telegram-polling
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è webhook:**
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π IP –∞–¥—Ä–µ—Å
- ‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–π –ø–æ—Ä—Ç 8443 (–∏–ª–∏ 443, 80, 88)
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt –∏–ª–∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π)

---

## üìÇ –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `telegram_polling.py` | –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |
| `telegram-polling.service` | Systemd —Å–µ—Ä–≤–∏—Å |
| `/etc/systemd/system/telegram-polling.service` | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å |

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞:
   ```bash
   sudo systemctl status telegram-polling
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   sudo journalctl -u telegram-polling -f
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
   ```bash
   curl http://localhost:8000/settings/telegram
   ```

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å Chat ID?

–û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
sudo journalctl -u telegram-polling -f
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞: `Chat: 123456789`

### Tesseract –ø–ª–æ—Ö–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç

–°–º–µ–Ω–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–∞ Parsio (cloud OCR —Å –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é):
```bash
curl -X PUT http://localhost:8000/settings/telegram \
  -H "Content-Type: application/json" \
  -d '{"enabled": true, "provider": "parsio"}'
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `PARSIO_API_KEY` –≤ `.env`.

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ñ–æ—Ç–æ –≤–∏–∑–∏—Ç–æ–∫ –±–æ—Ç—É –≤ Telegram, –∏ –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ CRM! üì∏‚û°Ô∏èüíº

