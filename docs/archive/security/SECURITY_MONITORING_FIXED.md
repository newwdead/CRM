# üîí –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò–°–ü–†–ê–í–õ–ï–ù–ê

## ‚ö†Ô∏è –ß–¢–û –ë–´–õ–û (–ö–†–ò–¢–ò–ß–ù–û!)

**–í–°–ï** –ø–æ—Ä—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±—ã–ª–∏ –æ—Ç–∫—Ä—ã—Ç—ã –¥–ª—è –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ **–ë–ï–ó –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò:**

```
‚ùå http://ibbase.ru:8080  ‚Üí cAdvisor (PUBLIC!)
‚ùå http://ibbase.ru:9090  ‚Üí Prometheus (PUBLIC!)
‚ùå http://ibbase.ru:3001  ‚Üí Grafana (PUBLIC!)
‚ùå http://ibbase.ru:9100  ‚Üí Node Exporter (PUBLIC!)
‚ùå http://ibbase.ru:9121  ‚Üí Redis Exporter (PUBLIC!)
‚ùå http://ibbase.ru:9187  ‚Üí PostgreSQL Exporter (PUBLIC!)
```

### –ß—Ç–æ –º–æ–≥ —É–≤–∏–¥–µ—Ç—å –ª—é–±–æ–π –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ:

- üì¶ **–í—Å–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (–∏–º–µ–Ω–∞, –≤–µ—Ä—Å–∏–∏, –æ–±—Ä–∞–∑—ã)
- üìä **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤** (CPU, –ø–∞–º—è—Ç—å, —Å–µ—Ç—å)
- üóÑÔ∏è **–ú–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –∑–∞–ø—Ä–æ—Å—ã)
- üî¥ **–ú–µ—Ç—Ä–∏–∫–∏ Redis** (–æ–ø–µ—Ä–∞—Ü–∏–∏, –ø–∞–º—è—Ç—å)
- üñ•Ô∏è **–ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞** (–Ω–∞–≥—Ä—É–∑–∫–∞, –¥–∏—Å–∫–∏)
- üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã** (—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã)
- **–ë–ï–ó –ü–ê–†–û–õ–Ø!**

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### 1Ô∏è‚É£ –ó–∞–∫—Ä—ã—Ç—ã –í–°–ï –ø–æ—Ä—Ç—ã (—Ç–æ–ª—å–∫–æ localhost)

```
‚úÖ cAdvisor:         127.0.0.1:8080  ‚Üê –¢–û–õ–¨–ö–û LOCALHOST
‚úÖ Prometheus:       127.0.0.1:9090  ‚Üê –¢–û–õ–¨–ö–û LOCALHOST
‚úÖ Grafana:          127.0.0.1:3001  ‚Üê —á–µ—Ä–µ–∑ Nginx
‚úÖ Node Exporter:    127.0.0.1:9100  ‚Üê –¢–û–õ–¨–ö–û LOCALHOST
‚úÖ Redis Exporter:   127.0.0.1:9121  ‚Üê –¢–û–õ–¨–ö–û LOCALHOST
‚úÖ PostgreSQL Exp.:  127.0.0.1:9187  ‚Üê –¢–û–õ–¨–ö–û LOCALHOST
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π docker-compose

**–§–∞–π–ª:** `docker-compose.monitoring-full.yml`

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –ø–æ—Ä—Ç–∞–º–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫ `127.0.0.1`:

```yaml
ports:
  - "127.0.0.1:8080:8080"  # –¢–æ–ª—å–∫–æ localhost!
```

### 3Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω API (backend)

**–§–∞–π–ª:** `backend/app/api/health.py`

- cAdvisor: –≤–Ω–µ—à–Ω–∏–π URL —É–¥–∞–ª—ë–Ω ‚Üí `url: None`
- Prometheus: –≤–Ω–µ—à–Ω–∏–π URL —É–¥–∞–ª—ë–Ω ‚Üí `url: None`
- –¢–æ–ª—å–∫–æ Grafana –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑: `https://monitoring.ibbase.ru`

---

## üß™ –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –ò–ó–í–ù–ï (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–æ):

```bash
$ curl http://ibbase.ru:8080
curl: (7) Failed to connect ‚úÖ –ó–ê–ö–†–´–¢–û

$ curl http://ibbase.ru:9090
curl: (7) Failed to connect ‚úÖ –ó–ê–ö–†–´–¢–û
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –õ–û–ö–ê–õ–¨–ù–û (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å):

```bash
$ curl http://localhost:8080
<html>...</html> ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

$ curl http://localhost:9090
<html>...</html> ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Nginx (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø):

```
https://monitoring.ibbase.ru ‚Üí ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
```

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ë–´–õ–û (–ù–ï–ë–ï–ó–û–ü–ê–°–ù–û):

```
Internet
   ‚Üì
   ‚îú‚îÄ‚Üí :8080  ‚Üí cAdvisor      ‚Üê ‚ùå PUBLIC ACCESS!
   ‚îú‚îÄ‚Üí :9090  ‚Üí Prometheus    ‚Üê ‚ùå PUBLIC ACCESS!
   ‚îú‚îÄ‚Üí :3001  ‚Üí Grafana       ‚Üê ‚ùå PUBLIC ACCESS!
   ‚îú‚îÄ‚Üí :9100  ‚Üí Node Exporter ‚Üê ‚ùå PUBLIC ACCESS!
   ‚îî‚îÄ‚Üí :9121  ‚Üí Redis Exporter‚Üê ‚ùå PUBLIC ACCESS!
```

### –°–¢–ê–õ–û (–ë–ï–ó–û–ü–ê–°–ù–û):

```
Internet
   ‚Üì
   HTTPS :443
   ‚Üì
   Nginx (with SSL + Auth)
   ‚Üì
   Grafana :3001 (localhost) ‚Üê ‚úÖ Protected
   ‚Üì
   Prometheus :9090 (localhost) ‚Üê ‚úÖ Internal
   ‚Üì
   ‚îú‚îÄ‚Üí cAdvisor :8080 (localhost)      ‚Üê ‚úÖ Internal
   ‚îú‚îÄ‚Üí Node Exporter :9100 (localhost) ‚Üê ‚úÖ Internal
   ‚îú‚îÄ‚Üí Redis Exporter :9121 (localhost)‚Üê ‚úÖ Internal
   ‚îî‚îÄ‚Üí PostgreSQL Exp :9187 (localhost)‚Üê ‚úÖ Internal
```

**–ü—Ä–∏–Ω—Ü–∏–ø:**
- üåê –¢–æ–ª—å–∫–æ Grafana –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑–≤–Ω–µ (—á–µ—Ä–µ–∑ HTTPS + –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- üîí –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ç–æ–ª—å–∫–æ localhost
- üîó Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ
- üìä Grafana —á–∏—Ç–∞–µ—Ç –∏–∑ Prometheus –ª–æ–∫–∞–ª—å–Ω–æ

---

## üìã CHECKLIST –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

```
‚úÖ cAdvisor :8080 - CLOSED to internet
‚úÖ Prometheus :9090 - CLOSED to internet
‚úÖ Grafana :3001 - CLOSED to internet (—á–µ—Ä–µ–∑ Nginx —Ç–æ–ª—å–∫–æ)
‚úÖ Node Exporter :9100 - CLOSED to internet
‚úÖ Redis Exporter :9121 - CLOSED to internet
‚úÖ PostgreSQL Exporter :9187 - CLOSED to internet
‚úÖ Grafana –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ https://monitoring.ibbase.ru
‚úÖ Grafana —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
‚úÖ Backend API –æ–±–Ω–æ–≤–ª—ë–Ω (–Ω–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö URL)
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ (CADVISOR_GUIDE.md)
```

---

## üìÅ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

1. **docker-compose.monitoring-full.yml** (–ù–û–í–´–ô)
   - –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –í—Å–µ –ø–æ—Ä—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ 127.0.0.1
   
2. **docker-compose.monitoring.yml** (–û–ë–ù–û–í–õ–Å–ù)
   - cAdvisor: 127.0.0.1:8080
   - Redis Exporter: 127.0.0.1:9121
   
3. **backend/app/api/health.py** (–û–ë–ù–û–í–õ–Å–ù)
   - cAdvisor: url = None
   - Prometheus: url = None
   
4. **CADVISOR_GUIDE.md** (–ù–û–í–´–ô)
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ cAdvisor
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± (–≤—Å–µ –ø–æ—Ä—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã):

```bash
cd /home/ubuntu/fastapi-bizcard-crm-ready

# –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker compose -f docker-compose.monitoring-full.yml up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
docker ps --format "table {{.Names}}\t{{.Ports}}"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```bash
# –ò–∑–≤–Ω–µ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–æ)
curl http://ibbase.ru:8080  # ‚Üê –¥–æ–ª–∂–Ω–æ fail
curl http://ibbase.ru:9090  # ‚Üê –¥–æ–ª–∂–Ω–æ fail

# –õ–æ–∫–∞–ª—å–Ω–æ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
curl http://localhost:8080  # ‚Üê –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
curl http://localhost:9090  # ‚Üê –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

# –ß–µ—Ä–µ–∑ Nginx (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
curl https://monitoring.ibbase.ru  # ‚Üê –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
```

---

## ‚ö° –°–¢–ê–¢–£–°

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –î–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ | –î–æ—Å—Ç—É–ø –ª–æ–∫–∞–ª—å–Ω–æ | –°—Ç–∞—Ç—É—Å |
|--------|------|--------------|-----------------|--------|
| **cAdvisor** | 8080 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |
| **Prometheus** | 9090 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |
| **Grafana** | 3001 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |
| **Grafana (Nginx)** | 443 | ‚úÖ HTTPS | ‚úÖ OK | ‚úÖ SECURE |
| **Node Exporter** | 9100 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |
| **Redis Exporter** | 9121 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |
| **PostgreSQL Exp** | 9187 | ‚ùå CLOSED | ‚úÖ OK | ‚úÖ SECURE |

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

1. **CADVISOR_GUIDE.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ cAdvisor
   - –ß—Ç–æ —Ç–∞–∫–æ–µ cAdvisor
   - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
   - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - Best practices
   
2. **docker-compose.monitoring-full.yml** - production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –í—Å–µ –ø–æ—Ä—Ç—ã localhost
   - –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û!

### –ò–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

cAdvisor health: down –≤ Prometheus (DNS resolution issue –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö compose —Ñ–∞–π–ª–æ–≤).

**–†–µ—à–µ–Ω–∏–µ:** –ë—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.

**–ù–æ:** –ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ - **–í–°–ï –ü–û–†–¢–´ –ó–ê–ö–†–´–¢–´!**

---

## üéØ –ò–¢–û–ì

### –î–û:
```
‚ùå 6 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚ùå –õ—é–±–æ–π –º–æ–≥ –≤–∏–¥–µ—Ç—å –≤—Å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

### –ü–û–°–õ–ï:
```
‚úÖ 0 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤ –Ω–∞–ø—Ä—è–º—É—é
‚úÖ –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ HTTPS + –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã
‚úÖ Best practices —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
```

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-10-25  
**Commit:** `0de47ba`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò–°–ü–†–ê–í–õ–ï–ù–ê**

üîí **–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ë–ï–ó–û–ü–ê–°–ù–ê!**
