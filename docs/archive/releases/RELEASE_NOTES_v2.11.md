# Release Notes v2.11 - Duplicate Detection Foundation
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–¢–∏–ø:** Minor Feature Release

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚ú® –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

#### 1. **–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
   - **Backend:**
     - ‚úÖ –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `DuplicateContact` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
     - ‚úÖ –ú–æ–¥–µ–ª—å `SystemSettings` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞
     - ‚úÖ API endpoint `GET /api/duplicates` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
     - ‚úÖ API endpoint `POST /api/duplicates/find` - –ø–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é
     - ‚úÖ API endpoint `POST /api/contacts/{id1}/merge/{id2}` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
     - ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ `fuzzywuzzy` (fuzzy matching)
     - ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ (similarity threshold)
     - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç-–ª–æ–≥ –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏

   - **Frontend:**
     - ‚úÖ Badge –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π ‚ö†Ô∏è —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º)
     - ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (`DuplicateMergeModal`)
     - ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–ª–µ–π –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ (—Ç–∞–±–ª–∏—Ü–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è–º–∏)
     - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ –∏ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–ª–µ–π
     - ‚úÖ Hover-—ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ badge –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
     - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

   - **Admin Panel:**
     - ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ duplicate detection –≤ System Settings:
       - `duplicate_detection_enabled` - –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
       - `duplicate_similarity_threshold` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ (0.0-1.0)
       - `duplicate_check_frequency_hours` - —á–∞—Å—Ç–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
       - `duplicate_check_new_only` - –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã

#### 2. **–ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –ø–æ–ª—è–º: `full_name`, `first_name`, `last_name`, `email`, `phone`, `company`, `position`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `fuzzywuzzy` –¥–ª—è fuzzy string matching
   - –£—á–µ—Ç –≤—Å–µ—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ (mobile, work, additional)
   - –í–æ–∑–≤—Ä–∞—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–ª—è—Ö
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–¥–∞–Ω–∏—è –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ –æ—Ç 0.0 –¥–æ 1.0

#### 3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è**
   - –í—ã–±–æ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (primary)
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è: –¥–∞–Ω–Ω—ã–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –∏ –≥—Ä—É–ø–ø
   - –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ OCR-–∫–æ—Ä—Ä–µ–∫—Ü–∏–π
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ audit log

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Backend:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `fuzzywuzzy==0.18.0`, `python-Levenshtein==0.25.0`
   - –ù–æ–≤—ã–π –º–æ–¥—É–ª—å `backend/app/duplicate_utils.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
   - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î: `backend/migrations/create_duplicates_table.sql`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö `match_fields` –≤ –º–æ–¥–µ–ª–∏: `String` ‚Üí `JSON` (jsonb –≤ PostgreSQL)
   - –£–¥–∞–ª–µ–Ω –Ω–µ–Ω—É–∂–Ω—ã–π `json.dumps()` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

2. **Frontend:**
   - –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `DuplicateMergeModal.js` (360 —Å—Ç—Ä–æ–∫)
   - –†–∞—Å—à–∏—Ä–µ–Ω `ContactList.js`:
     - State –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
     - –§—É–Ω–∫—Ü–∏—è `loadDuplicates()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–∑ API
     - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ badge
   - –î–æ–±–∞–≤–ª–µ–Ω tooltip –¥–ª—è badge –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

3. **Database:**
   - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `duplicate_contacts` —Å constraint `unique_duplicate_pair`
   - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `system_settings` –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - Trigger `ensure_contact_order` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ contact_id
   - View `duplicate_contacts_view` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ status –∏ similarity_score

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

1. **Backend:**
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `TypeError: the JSON object must be str, bytes or bytearray, not dict` –≤ endpoint `/api/duplicates`
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `DatatypeMismatch: column "match_fields" is of type jsonb but expression is of type character varying`
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `models.py`: –¥–æ–±–∞–≤–ª–µ–Ω `JSON` –∏–∑ SQLAlchemy
   - ‚úÖ –£–¥–∞–ª–µ–Ω `json.loads()` –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ `match_fields` (SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç JSON)

2. **Database:**
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è system_settings: `duplicates` ‚Üí `Duplicate Detection`

### üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### DuplicateContact Model
```python
class DuplicateContact(Base):
    __tablename__ = "duplicate_contacts"
    id: int
    contact_id_1: int  # FK to contacts.id
    contact_id_2: int  # FK to contacts.id
    similarity_score: float  # 0.0 to 1.0
    match_fields: JSON  # {"name": 0.95, "email": 1.0}
    status: str  # 'pending', 'reviewed', 'merged', 'ignored'
    auto_detected: bool
    detected_at: datetime
    reviewed_at: datetime
    reviewed_by: int  # FK to users.id
    merged_into: int  # FK to contacts.id
```

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:**
- ‚úÖ Backend API endpoints (GET, POST, PUT –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (26 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑–µ)
- ‚úÖ Badge –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ System Settings

### üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è v2.12)
- –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- UI –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ (v2.12)

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
2. –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (Celery) –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
3. –†–∞–∑–¥–µ–ª "–î—É–±–ª–∏–∫–∞—Ç—ã" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–∞—Ä
4. –ú–∞—Å—Å–æ–≤–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. –£–ª—É—á—à–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (weighted scoring)
6. –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ CSV

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git pull origin main

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose exec db psql -U postgres -d bizcard_crm < backend/migrations/create_duplicates_table.sql
docker compose exec db psql -U postgres -d bizcard_crm -c "UPDATE system_settings SET category='Duplicate Detection' WHERE category='duplicates';"

# 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose up -d --build

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
curl -X POST "http://localhost:8000/api/duplicates/find?threshold=0.75" \
  -H "Authorization: Bearer <token>"
```

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤](./docs/duplicate_detection.md)
- [API Reference –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤](./docs/api_duplicates.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](./docs/user_guide_duplicates.md)

### üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ibbase CRM! –í–∞—à–∏ –æ—Ç–∑—ã–≤—ã –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ª—É—á—à–µ.

---

**–í–µ—Ä—Å–∏—è:** v2.11  
**Commit:** (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏ —Ä–µ–ª–∏–∑–µ)  
**Docker Images:** 
- Backend: `ghcr.io/newwdead/crm-backend:v2.11`
- Frontend: `ghcr.io/newwdead/crm-frontend:v2.11`
