# üéõÔ∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å OCR v1.0 / v2.0 - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üìç –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å

**Web UI:**
```
https://ibbase.ru/admin?tab=settings
```

–í –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–≤–∏–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"–í–µ—Ä—Å–∏—è OCR"** —Å –¥–≤—É–º—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏.

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Web UI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://ibbase.ru/admin?tab=settings`
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é "–í–µ—Ä—Å–∏—è OCR" –≤–≤–µ—Ä—Ö—É
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –Ω—É–∂–Ω–æ–π –≤–µ—Ä—Å–∏–∏
4. –ì–æ—Ç–æ–≤–æ! ‚úÖ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
TOKEN="your_admin_token_here"

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ v1.0 (–±—ã—Å—Ç—Ä–æ)
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v1.0"}'

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ v2.0 (—Ç–æ—á–Ω–æ)
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v2.0"}'
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker exec -it bizcard-db psql -U bizcard -d bizcard_crm

# –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é
UPDATE app_settings SET value = 'v1.0' WHERE key = 'ocr_version';

# –∏–ª–∏
UPDATE app_settings SET value = 'v2.0' WHERE key = 'ocr_version';

# –í—ã–π—Ç–∏
\q
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | OCR v1.0 (Tesseract) | OCR v2.0 (PaddleOCR + AI) |
|----------------|----------------------|---------------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° 1-2 —Å–µ–∫—É–Ω–¥—ã | üê¢ 3-5 —Å–µ–∫—É–Ω–¥ |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | 60-70% | 80-90% |
| **AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** | ‚ùå | ‚úÖ LayoutLMv3 |
| **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** | ‚ùå | ‚úÖ |
| **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MinIO** | ‚ùå | ‚úÖ |
| **–ê–≤—Ç–æ—Ñ–æ–ª–±—ç–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ** | ‚Äî | ‚úÖ –Ω–∞ v1.0 |

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### v1.0 - –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏:
- ‚úÖ Batch-–∏–º–ø–æ—Ä—Ç –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –≤–∏–∑–∏—Ç–∫–∏ —Ç–æ–ª—å–∫–æ —Å —Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å, –∞ –Ω–µ —Ç–æ—á–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

### v2.0 - –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞:
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ –≤–∏–∑–∏—Ç–∫–∏ —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏
- ‚úÖ –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- ‚úÖ –ù—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–µ–π
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ML –æ–±—É—á–µ–Ω–∏—è

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

### –°–ø–æ—Å–æ–± 1: API (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞)
```bash
curl https://ibbase.ru/api/ocr/settings/version | jq '.version'
```

### –°–ø–æ—Å–æ–± 2: –í –±—Ä–∞—É–∑–µ—Ä–µ (Console)
```javascript
fetch('/api/ocr/settings/version')
  .then(r => r.json())
  .then(d => console.log('OCR version:', d.version));
```

### –°–ø–æ—Å–æ–± 3: –í –ª–æ–≥–∞—Ö
```bash
# Backend
docker logs bizcard-backend | grep "OCR v"

# Celery
docker logs bizcard-celery-worker | grep "Using OCR"
```

### –°–ø–æ—Å–æ–± 4: –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```bash
docker exec bizcard-db psql -U bizcard -d bizcard_crm \
  -c "SELECT value FROM app_settings WHERE key = 'ocr_version';"
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–∑–∏—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

**1. –õ–æ–≥–∏ Celery:**
```bash
docker logs bizcard-celery-worker 2>&1 | tail -50
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- `üöÄ Using OCR v2.0 for filename.jpg` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è v2.0
- `üîß Using OCR v1.0 for filename.jpg` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è v1.0
- `‚ö†Ô∏è OCR v2.0 failed, falling back to v1.0` - –∞–≤—Ç–æ—Ñ–æ–ª–±—ç–∫

**2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```
https://ibbase.ru/admin?tab=monitoring
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ú–µ—Ç–æ–¥ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Confidence score
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –≤–∏–∂—É —Å–µ–∫—Ü–∏—é "–í–µ—Ä—Å–∏—è OCR"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
Ctrl + Shift + R

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å frontend
docker compose restart frontend
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ—Ä—Å–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend –∏ celery
docker compose restart backend celery-worker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î
docker exec bizcard-db psql -U bizcard -d bizcard_crm \
  -c "SELECT * FROM app_settings WHERE key = 'ocr_version';"
```

### –ü—Ä–æ–±–ª–µ–º–∞: 403 Forbidden –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–µ—Ä—Å–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:** Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
curl https://ibbase.ru/api/auth/me \
  -H "Authorization: Bearer $TOKEN" | jq '.role'
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `"admin"`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **OCR_VERSION_TOGGLE.md** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (411 —Å—Ç—Ä–æ–∫)
- **OCR_TOGGLE_TEST.md** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é (331 —Å—Ç—Ä–æ–∫)
- **OCR_TOGGLE_COMPLETE.md** - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç (490+ —Å—Ç—Ä–æ–∫)
- **OCR_TOGGLE_QUICKSTART.md** - –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker ps --format "table {{.Names}}\t{{.Status}}"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose restart

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ backend
docker logs bizcard-backend -f

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ celery
docker logs bizcard-celery-worker -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é OCR
curl https://ibbase.ru/api/ocr/settings/version

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤–∏–∑–∏—Ç–∫—É
curl -X POST https://ibbase.ru/api/ocr/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@business_card.jpg"
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ OCR –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –∑–∞–¥–∞—á:
- üèÉ **v1.0** - –±—ã—Å—Ç—Ä–æ
- üéØ **v2.0** - —Ç–æ—á–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã!**

---

**–í–µ—Ä—Å–∏—è:** 6.1.0  
**–î–∞—Ç–∞:** 27 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

