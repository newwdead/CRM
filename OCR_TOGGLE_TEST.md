# –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è OCR –≤–µ—Ä—Å–∏–π

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### Backend
1. ‚úÖ –°–æ–∑–¥–∞–Ω API endpoint `/api/ocr/settings/version` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–µ–π OCR
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints:
   - `GET /api/ocr/settings/version` - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   - `POST /api/ocr/settings/version` - –∏–∑–º–µ–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é (—Ç–æ–ª—å–∫–æ admin)
   - `GET /api/ocr/settings/config` - –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é OCR
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `backend/app/api/ocr.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ OCR –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `backend/app/tasks.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ OCR –≤ Celery –∑–∞–¥–∞—á–∞—Ö (2 –º–µ—Å—Ç–∞)
5. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω router –≤ `backend/app/api/__init__.py`

### Frontend
1. ‚úÖ –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `OCRVersionToggle.js` —Å –∫—Ä–∞—Å–∏–≤—ã–º UI
2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `SystemSettings.js` (–≤–∫–ª–∞–¥–∫–∞ Settings –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏)
3. ‚úÖ –°–æ–∑–¥–∞–Ω —ç–∫—Å–ø–æ—Ä—Ç –≤ `frontend/src/components/admin/index.js`

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback v2.0 ‚Üí v1.0 –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ `app_settings`)
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –∫–∞–∂–¥–æ–π –≤–µ—Ä—Å–∏–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Web UI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://ibbase.ru/admin?tab=settings
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- –°–µ–∫—Ü–∏—é "–í–µ—Ä—Å–∏—è OCR" / "OCR Version" –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –î–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏: OCR v1.0 –∏ OCR v2.0
- –¢–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é —Ü–≤–µ—Ç–æ–º
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É "OCR v1.0"
2. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–í–µ—Ä—Å–∏—è OCR —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞"
3. –ö–∞—Ä—Ç–æ—á–∫–∞ v1.0 –¥–æ–ª–∂–Ω–∞ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É "OCR v2.0"
5. –ö–∞—Ä—Ç–æ—á–∫–∞ v2.0 –¥–æ–ª–∂–Ω–∞ –≤—ã–¥–µ–ª–∏—Ç—å—Å—è —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API (—á–µ—Ä–µ–∑ curl)

#### –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```bash
curl https://ibbase.ru/api/ocr/settings/version
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "version": "v2.0",
  "available_versions": ["v1.0", "v2.0"],
  "v1": {...},
  "v2": {...}
}
```

#### –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é (—Ç—Ä–µ–±—É–µ—Ç—Å—è admin —Ç–æ–∫–µ–Ω)
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
TOKEN="YOUR_ADMIN_TOKEN_HERE"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å v1.0
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v1.0"}'

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å v2.0
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v2.0"}'
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã OCR

#### –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤–∏–∑–∏—Ç–∫—É —á–µ—Ä–µ–∑ v1.0
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å v1.0
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v1.0"}'

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫—É
curl -X POST https://ibbase.ru/api/ocr/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@/path/to/business_card.jpg"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs bizcard-celery-worker 2>&1 | grep "Using OCR v1.0"
```

#### –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤–∏–∑–∏—Ç–∫—É —á–µ—Ä–µ–∑ v2.0
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å v2.0
curl -X POST https://ibbase.ru/api/ocr/settings/version \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"version": "v2.0"}'

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫—É
curl -X POST https://ibbase.ru/api/ocr/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@/path/to/business_card.jpg"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs bizcard-celery-worker 2>&1 | grep "Using OCR v2.0"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker exec -it bizcard-db psql -U bizcard -d bizcard_crm

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É
SELECT * FROM app_settings WHERE key = 'ocr_version';

# –í—ã–π—Ç–∏
\q
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```
https://ibbase.ru/admin?tab=monitoring
```

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- –ú–µ—Ç–æ–¥ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (OCR v1.0 –∏–ª–∏ v2.0)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Confidence score

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### OCR v1.0 (Tesseract)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 1-2 —Å–µ–∫—É–Ω–¥—ã
- –í –ª–æ–≥–∞—Ö: `üîß Using OCR v1.0 for filename.jpg`
- Recognition method: `Tesseract v1.0`

### OCR v2.0 (PaddleOCR + AI)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 3-5 —Å–µ–∫—É–Ω–¥
- –í –ª–æ–≥–∞—Ö: `üöÄ Using OCR v2.0 for filename.jpg`
- Recognition method: `PaddleOCR v2.0 + LayoutLMv3`
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: validation applied, saved to MinIO

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback
–ï—Å–ª–∏ v2.0 –Ω–µ —Å–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
- –í –ª–æ–≥–∞—Ö: `‚ö†Ô∏è OCR v2.0 failed, falling back to v1.0`
- –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞: `‚úÖ OCR v1.0 (Tesseract) fallback successful`
- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### Backend
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OCR
docker logs bizcard-backend 2>&1 | grep -E "OCR v[12].0"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
docker logs bizcard-backend 2>&1 | grep -i error | tail -20
```

### Celery Worker
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OCR
docker logs bizcard-celery-worker 2>&1 | grep -E "Using OCR|OCR.*completed"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fallback
docker logs bizcard-celery-worker 2>&1 | grep "fallback"
```

### Frontend (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)
```javascript
// –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
fetch('/api/ocr/settings/version')
  .then(r => r.json())
  .then(d => console.log('Current OCR version:', d.version));
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ UI
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å frontend
docker compose restart frontend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ frontend
docker logs bizcard-frontend
```

### –ü—Ä–æ–±–ª–µ–º–∞: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
docker compose restart backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ router –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
docker logs bizcard-backend 2>&1 | grep "ocr/settings"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ—Ä—Å–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î
docker exec bizcard-db psql -U bizcard -d bizcard_crm \
  -c "SELECT * FROM app_settings WHERE key = 'ocr_version';"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Celery
docker compose restart celery-worker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
docker logs bizcard-celery-worker 2>&1 | tail -50
```

### –ü—Ä–æ–±–ª–µ–º–∞: 403 Forbidden –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
**–ü—Ä–∏—á–∏–Ω–∞:** Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl https://ibbase.ru/api/auth/me \
  -H "Authorization: Bearer $TOKEN" | jq '.role'

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "admin"
```

## ‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
curl https://ibbase.ru/api/ocr/settings/config \
  -H "Authorization: Bearer $TOKEN" | jq
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
curl https://ibbase.ru/api/monitoring/dashboard \
  -H "Authorization: Bearer $TOKEN" | jq '.ocr_stats'
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å 10 –∫–∞—Ä—Ç–æ—á–µ–∫ —á–µ—Ä–µ–∑ v1.0
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å 10 –∫–∞—Ä—Ç–æ—á–µ–∫ —á–µ—Ä–µ–∑ v2.0
# –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
```

## üìù –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí Settings
- [ ] –£–≤–∏–¥–µ—Ç—å —Å–µ–∫—Ü–∏—é "–í–µ—Ä—Å–∏—è OCR"
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ v1.0
- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è v1.0 (–ª–æ–≥–∏)
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ v2.0
- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è v2.0 (–ª–æ–≥–∏)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint —á–µ—Ä–µ–∑ curl
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–î–∞—Ç–∞:** 27 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 6.1.0

